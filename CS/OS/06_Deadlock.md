# 교착상태

# 교착상태의 개요

## 1. 교착상태의 정의

### 교착 상태(dead lock)

- 2개 이상의 프로세스가 다른 프로세스의 작업이 끝나기만 기다리며 작업을 더 이상 진행하지 못하는 상태

### 아사현상과의 차이

- 아사현상은 운영체제가 잘못된 정책을 사용하여 특정 프로세스의 작업이 지연되는 문제인 반면,
- 교착 상태는 여러 프로세스가 작업을 진행하다보니 자연적으로 발생하는 문제
- 따라서 교착상태가 발생하면 운영체제가 강압적으로 해결해야 함



## 2. 교착상태의 발생

- 시스템 자원, 공유변수, 응용 프로그램 등 사용시 발생할 수 있음

### 시스템 자원

- 다른 프로세스와 공유할 수 없는 자원을 사용할 때 발생

### 공유 변수

- 

### 응용 프로그램

- 데이터베이스가 데이터의 일관성을 유지하기 위해 잠금을 사용하는 과정에서 교착상태가 발생할 수 있음



## 3. 자원할당 그래프

### 자원할당 그래프(resource allocation graph)

- 프로세스가 어떤 자원을 사용 중이고 어떤 자원을 기다리고 있는지를 방향성이 있는 그래프로 표현한 것
- 프로세스는 원으로, 자원은 사각형으로 표현
- 프로세스가 자원을 사용중인 경우: 자원에서 프로세스로 향하는 실선의 화살표로 표시
- 프로세스가 자원을 기다리는 경우: 프로레스에서 자원으로 향하는 점선의 화살표로 표시
- 다중 자원(multiple resource)
  - 자원이 2개 이상의 프로세스를 동시에 허용하는 경우
  - 자원을 나타내는 사각형 내에 허용하는 프로세스의 수만큼 작은 동그라미로 표현

# 교착 상태 필요조건

## 1. 교착 상태 필요조건

- 상호배제, 비선점, 점유와 대기, 원형대기 4가지 조건을 모두 충족해야 발생

### 상호 배제(mutual exclusion)

- 한 프로세스가 사용하는 자원은 다른 프로세스와 **공유할 수 없는** 배타적인 자원이어야 한다는 것

### 비선점(non-preemption)

- 한 프로세스가 사용 중인 자원은 **중간에** 다른 프로세스가 **빼앗을 수 없는** 비선점 자원이어야 한다는 것

### 점유와 대기(hold and wait)

- 프로세스가 어떤 자원을 할당받은 상태에서 다른 자원을 기다리는 상태여야 함

### 원형 대기(circular wait)

- 점유와 대기를 하는 프로세스 간의 관계가 원을 이루어야 함



## 2. 식사하는 철학자 문제와 교착 상태 필요조건

- 교착상태 필요조건을 식사하는 철학자 문제에 적용

### 상호 배제

- 포크는 한 사람이 사용하면 다른 사람이 사용할 수 없는 배타적 자원임

### 비선점

- 사용중인 포크는 도중에 빼앗을 수 없음

### 점유와 대기

- 한 철학자가 왼쪽 포크와 오른쪽 포크를 모두 점유하거나, 두 포크를 모두 기다리는 상태라면 교착상태 X
- 하나의 자원을 점유한 상태에서 다른 자원을 기다리면 서로가 서로의 진행을 방해하는 상태이므로 교착상태 발생

### 원형 대기

- 원을 이룬다는 것은 선후관계를 결정할 수 없어 문제가 계속 맴돈다는 의미
- 만약 철학자들이 원형 식탁이 아닌 사각형의 식탁에서 한 줄로 식사를 하면, 한쪽 끝에서부터 식사를 시작하고 다 사용한 포크를 내려놓으면 교착상태가 발생하지 않음

# 교착 상태 해결 방법

## 1. 교착 상태 해결 방법

- 교착상태의 해결방법: 예방, 회피, 검출 + 회복

  | 해결 방법 | 특징                                           |
  | --------- | ---------------------------------------------- |
  | 예방      | 교착 상태를 유발하는 필요조건들을 무력화       |
  | 회피      | 교착 상태가 발생하지 않을 수준으로 자원을 할당 |
  | 검출      | 자원할당 그래프를 사용하여 교착 상태를 발견    |
  | 회복      | 교착 상태를 검출한 후 해결                     |

  

## 2. 교착 상태 예방

### 정의

- 교착 상태는 필요조건 4가지 중 하나라도 충족되면 발생하지 않기 때문에, 네 가지 조건 중 하나라도 발생하지 않도록 막는 방법

### 상호 배제 예방

- 시스템 내에 있는 상호배타적인 모든 자원을 없애버리는 방법
- 즉 시스템 내에 공유할 수 있는 자원만 남기는 것
- 그러나 현실적으로 어려운 방법이라 잘 사용되지 않음

### 비선점 예방

- 모든 자원을 도중에 빼앗을 수 있게 하는 방법
- 하지만 이 방법 역시 여러 문제로 인해 사용되지 않음
  - 빼앗을 수 있는 기준, 빼앗은 시간 중 얼마나 사용하도록 할지 등등
- 또한 아사현상을 일으킬 수 있고, 아사현상의 발생을 에이징으로 해결한다고 하더라도, 그렇게 되면 에이징을 통해 높은 우선순위를 가진 프로세스가 점유한 자원은 비선점 자원이 되어 다시 교착상태에 빠질 수 있음

### 점유와 대기 예방

- 자원을 전부 할당하거나 아니면 아예 할당받지 못하게 하여(all or nothing) 프로세스가 자원을 점유한 상태에서 다른 자원을 기다리지 못하게 하는 방법
- 철학자 문제를 예로 들면 한 철학자가 식사를 시작할 때 양손에 포크를 잡지 못했다면 한손에 든 포크는 반납해야 함
- 그렇다면 동작이 빠른 철학자가 먼저 식사할 수 있게 됨
- 이 방법은 아예 제약을 풀어버리는 앞선 두 방법과 달리 프로세스의 자원 사용 방식을 변화시켜서 교착상태를 처리한다는 점에서 의미가 있음
- 단점
  - 프로세스가 자신이 사용하는 모든 자원을 자세히 알기 어려움. 어떤 상태에서 필요한 자원을 모두 확보후 실행했는데 추가로 필요한 자원이 생긴다면? 다시 확보하기 어렵게 됨
  - 자원의 활용성이 떨어짐. 필요한 모든 자원을 할당받게 되므로, 당장 사용하지 않을 자원도 미리 선점하게 되어 낭비가 심해짐
  - 많은 자원을 사용하는 프로세스가 그렇지 않은 프로세스보다 불리함
  - 결국 일괄 작업 방식으로 동작함

### 원형 대기 예방



## 3. 교착 상태 회피

## 4. 교착 상태 검출

## 5. 교착 상태 회복



# 다중 자원과 교착 상태 검출

