# 6장 - 전송계층: 신뢰할 수 있는 데이터 전송하기

[TOC]



# 전송 계층

- 라우터를 통해서 전송하더라도 목적지에 제대로 도착하지 못할 수도 있음
- 물리계층 / 데이터 링크 계층 / 네트워크 계층 이렇게 3계층이 있으면 목적지에 데이터를 보낼 수 있음. 하지만 이들 계층에서는 데이터가 손상/유실되더라도 아무것도 해주지 않음
- 전송계층은 목적지에 신뢰할 수 있는 데이터를 전달하기 위해서 필요



## 전송 계층의 역할



### 오류 점검 기능

- 오류 발생시 데이터를 재전송하도록 요청
- 즉 네트워크 계층이 목적지에 데이터를 전달하는 역할이라면, 전송 계층은 데이터가 제대로 도착했는지 확인하는 역할



### 목적지 식별 기능

- 전송된 데이터의 목적지가 어떤 애플리케이션인지 식별하는 기능
- 한 컴퓨터 내에 여러 애플리케이션이 있는데, 그 중 어느 애플리케이션에 전송해야 하는지를 전송계층에서 알려줌



## 연결형 통신과 비연결형 통신

- 전송계층의 특징: 신뢰성, 정확성, 효율성
- 연결형통신: 신뢰할 수 있고 정확한 데이터를 전달하는 통신
- 비연결형 통신: 효율적으로 데이터를 전달하는 통신



### 연결형 통신

- 상대방과 서로의 의사를 확인해가면서 통신하는 방식
- TCP(Transmission Control Protocol, 전송 제어 프로토콜)



### 비연결형 통신

- 상대를 확인하지 않고 일방적으로 통신
- 효율성이 우선이기 때문에 확인 절차가 없음
- 동영상을 볼 때 주로 사용. 동영상을 보는데 신뢰성/정확성을 따지고 있으면 데이터 도착 속도가 느려질 것이므로 동영상에 적합하지 않다.
- UDP(User Datagram Protocol, 사용자 데이터그램 프로토콜) 사용





## TCP

- TCP 헤더: TCP로 전송할 때 붙이는 헤더
- 세그먼트: TCP 헤더가 붙은 데이터
- TCP 헤더에 포함된 데이터
  - 출발지 포트번호(16비트)
  - 목적지 포트번호(16비트)
  - 일련번호(32비트)
  - 확인 응답 번호(32비트)
  - 헤더 길이(4비트)
  - 예약 영역(6비트)
  - 코드 비트(6비트): TCP헤더으 107~112번째 비트. 연결의 제어정보가 기록
    - URG, ACK, PSH, RST, SYN, FIN의 6비트로 구성. 초기값은 0이고 활성화되면 1이 됨
  - 윈도우 크기(16비트)
  - 체크섬(16비트)
  - 긴급 포인터(16비트)
  - 옵션
- 연결(connection): TCP 통신에서 정보를 전달하기 위해 사용되는 가상의 통신로
  - 연결이 확립되려면 코드비트 중에서 SYN과 ACK가 필요
  - SYN: 연결요청
  - ACK: 확인 응답



### 3-way 핸드셰이크

- 연결을 확립하려면 컴퓨터1과 컴퓨터2 사이에서 총 3번의 확인이 이루어짐
- 첫번째는 컴퓨터1로부터 컴퓨터2로 연결확립요청(SYN)
- 두번째는 컴퓨터2로부터 컴퓨터1로 연결확립응답+연결확립요청(SYN+ACK)
- 세번째는 다시 컴퓨터1에서 컴퓨터2로 연결확립응답(ACK)

- 각 경우에 해당 비트가 1로 활성화됨
- 데이터를 전송한 후에는 연결을 끊기 위한 요청을 교환
  - 이 때는 FIN과 ACK를 사용
  - FIN: 연결 종료를 뜻함
  - 이때는 총 4번
  - 1 -> 2: 연결종료 요청(FIN)
  - 2 -> 1: 연결종료 응답(ACK)
  - 2 -> 1: 연결 종료 요청(FIN)
  - 1 -> 2: 연결 종료 응답(ACK)



## 일련번호와 확인 응답 번호의 구조



### 일련번호와 확인 응답 번호

- 3-way 핸드셰이크가 끝나고 데이터를 전송할 때는 TCP 헤더의 일련번호(32비트)와 확인응답번호(32비트)를 사용
- 일련번호: 송신 측에서 수신측으로 해당 데이터가 몇 번째 데이터인지 알려주는 역할. TCP는 데이터를 분할해서 보내기 때문에 일련번호가 필요
- 확인응답번호: 수신 측이 몇 번째 데이터를 수신했는지 송신 측에 알려주는 역할
- 일련번호/확인응답번호를 활용하여 데이터가 손상되거나 유실된 경우 데이터를 재전송하게 되어있는데, 이를 재전송 제어라고 함



### 윈도우 크기

- 위와 같은 방식은 세그먼트(데이터) 하나를 보낼 때마다 확인 응답을 한 번 반환하는 방식
- 그래서 효율이 높지 않음
- 따라서 이와 달리 세그먼트를 연속해서 보낸후에 확인응답을 반환하면 효율이 높음
- 이 경우에는 '버퍼(buffer)'라고 하는 세그먼트를 일시적으로 보관하는 장소가 있음
- 오버플로(overflow): 수신 측이 대량으로 데이터를 전송 받은 경우에 보관하지 못하고 넘치는 것
- 오버플로가 발생하지 않도록 '버퍼의 한계 크기'를 알고 있어야 하는데, 이것이 TCP 헤더의 '윈도우 크기(window size)'에 해당
- 윈도우 크기(window size): 얼마나 많은 데이터를 저장해 둘 수 있는지를 의미. 즉 매번 확인 응답을 하지 않고 연속해서 송수신할 수 있는 데이터 크기
- 3-way 핸드셰이크 과정에서 서로의 윈도우 크기를 확인하고, 세그먼트를 오버플로가 발생하지 않도록 보냄
- 이제 세그먼트를 보내는 것과 확인응답을 하는 것 모두 연속적으로 이루어질 수 있음



## 포트번호



### 포트번호란?

- 전송계층의 또다른 역할인 목적지 식별 기능에 관한 것

- TCP 헤더에 포트 번호가 있기 때문에 애플리케이션을 구분할 수 있음

  - 출발지 포트 번호
  - 목적지 포트 번호

- 사용 가능한 포트 번호는 0~65535번

- 0~1023번: 주요 프로토콜이 사용하도록 예약

  - 잘 알려진 포트(well-known ports)라고도 함

- 1024번: 예약되어있지만 사용되지는 않는 포트

- 1025번 이상: 랜덤포트. 클라이언트 측의 송신 포트로 사용

  | 애플리케이션 | 포트 번호 |
  | ------------ | --------- |
  | SSH          | 22        |
  | SMTP         | 25        |
  | DNS          | 53        |
  | HTTP         | 80        |
  | POP3         | 110       |
  | HTTPS        | 443       |

- 애플리케이션
  - SSH(Secure Shell, 시큐어 셸): 네트워크 상의 다른 컴퓨터에 로그인하거나 원격 시스템에서 명령을 실행하고 다른 시스템으로 파일을 복사할 수 있도록 해 주는 응용 프로그램 또는 그 프로토콜
  - SMTP(Simple Mail Transfer Protocol, 간이 전자 우편 전송 프로토콜): 인터넷에서 이메일을 보내기 위해 이용되는 프로토콜
  - DNS(Domain Name System, 도메인 네임 시스템)
  - HTTP
  - POP3
  - HTTPS



## UDP의 구조



### UDP란?

- 비연결형 통신
- 효율성 중시
- 데이터를 빠르고 효율적으로 보내는게 장점
  - 그래서 스트리밍 방식으로 전송하는 동영상 서비스 등에 사용



### UDP 헤더란?

- UDP 헤더가 붙은 데이터를 UDP 데이터그램이라고 함
- 출발지 포트 번호(16비트) + 목적지 포트 번호(16비트)  + 길이(16비트) + 체크섬(16비트)
- TCP헤더와 달리 신뢰성과 정확성이 필요하지 않아서 이 정보만으로 충분



### 방식 및 활용

- 효율성과 속도를 중시하므로 상대방을 확인하지 않고 연속해서 데이터를 보냄
- UDP를 사용하면 랜에 있는 컴퓨터나 네트워크 장비에 데이터를 일괄로 보낼 수 있음. 이를 브로드캐스트(broadcast)라고 함
- TCP는 브로드캐스트와 같이 불특정 다수에게 보내는 통신에는 부적합